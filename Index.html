<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #f4f6fb;
      --card: #ffffff;
      --primary: #2f3a8f;
      --secondary: #e9ecff;
      --text: #1f2937;
      --muted: #6b7280;
      --border: #e5e7eb;
      --radius: 14px;
      --success: #10b981;
    }

    body { margin: 0; font-family: "Cairo", system-ui, sans-serif; background: var(--bg); color: var(--text); }
    .container { max-width: 1100px; margin: auto; padding: 32px 20px 60px; }
    
    header { text-align: center; margin-bottom: 30px; }
    header h1 { margin: 0 0 10px; color: var(--primary); }
    header p { color: var(--muted); margin: 0; }

    /* Tabs */
    .tabs-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 30px; background: #fff; padding: 15px; border-radius: var(--radius); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .tab-btn { background: transparent; border: 2px solid var(--secondary); color: var(--muted); padding: 8px 16px; border-radius: 50px; font-family: "Cairo", sans-serif; font-weight: 700; cursor: pointer; transition: all 0.3s ease; }
    .tab-btn:hover { border-color: var(--primary); color: var(--primary); }
    .tab-btn.active { background: var(--primary); border-color: var(--primary); color: #fff; }

    /* Content Area */
    #content-area { min-height: 300px; position: relative; }
    
    /* Loading Spinner */
    .loader { display: none; position: absolute; top: 50px; left: 50%; transform: translateX(-50%); }
    .loader.active { display: block; }
    .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* Subject Cards */
    .subject-content { display: none; animation: fadeIn 0.4s ease-in-out; }
    .subject-content.active-content { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .subject-card { background: var(--card); border-radius: var(--radius); margin-bottom: 20px; border: 1px solid var(--border); overflow: hidden; }
    .card-header { padding: 15px 20px; font-size: 20px; font-weight: 700; color: var(--primary); background: linear-gradient(135deg, var(--secondary), #ffffff); border-bottom: 1px solid var(--border); }

    /* Details/Summary */
    details { border-bottom: 1px solid var(--border); transition: all 0.3s ease; }
    details:last-child { border-bottom: none; }
    summary { cursor: pointer; padding: 15px 20px; font-weight: 600; background: #fafbff; display: flex; justify-content: space-between; align-items: center; list-style: none; }
    summary::-webkit-details-marker { display: none; }
    summary:hover { background: #f0f4ff; }
    summary::after { content: '+'; font-size: 18px; color: var(--primary); }
    details[open] summary::after { content: '-'; }

    /* Tables */
    .table-wrapper { padding: 0; background: #fff; overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; min-width: 500px; }
    th, td { padding: 14px 20px; border-bottom: 1px solid var(--border); vertical-align: middle; }
    th.chapter-col { width: 25%; text-align: right; color: var(--primary); background-color: #fcfcfc; font-size: 0.9rem; }
    td.desc-col { text-align: right; font-weight: 500; }
    th.status-col { width: 140px; text-align: center; color: var(--muted); }
    td.status-cell { text-align: center; }

    /* Button Style for Upload */
    .upload-btn {
      background-color: var(--secondary);
      color: var(--primary);
      border: 1px solid transparent;
      padding: 8px 16px;
      border-radius: 8px;
      font-family: inherit;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.85rem;
    }
    .upload-btn:hover { background-color: var(--primary); color: white; transform: scale(1.02); }
    .upload-btn.uploading { opacity: 0.7; cursor: wait; pointer-events: none; }
    
    /* Animation for removal */
    .fade-out { animation: fadeOutRight 0.5s forwards; }
    @keyframes fadeOutRight { to { opacity: 0; transform: translateX(-20px); height: 0; padding: 0; border: none; } }

    /* Empty State */
    .empty-state { padding: 40px; text-align: center; color: var(--muted); font-style: italic; }

    @media (max-width: 600px) {
      .tabs-container { flex-wrap: nowrap; overflow-x: auto; justify-content: flex-start; padding-bottom: 10px; }
      .tab-btn { white-space: nowrap; flex: 0 0 auto; }
      th.chapter-col { width: 30%; font-size: 12px; }
    }
  </style>
</head>

<body>
<div class="container">
  <header>
    <h1>Ù…ØªØ§Ø¨Ø¹Ø© Ø±ÙØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h1>
    <p>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
  </header>

  <div class="tabs-container">
    <button class="tab-btn active" onclick="switchTab('chemistry')">Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡</button>
    <button class="tab-btn" onclick="switchTab('biology')">Ø§Ù„Ø£Ø­ÙŠØ§Ø¡</button>
    <button class="tab-btn" onclick="switchTab('math')">Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</button>
    <button class="tab-btn" onclick="switchTab('arabic')">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
    <button class="tab-btn" onclick="switchTab('physics')">Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡</button>
    <button class="tab-btn" onclick="switchTab('english')">English</button>
  </div>

  <div id="loader" class="loader active"><div class="spinner"></div></div>

  <div id="content-area"></div>

</div>

<script>
  // ---------------------------------------------------------
  // CONFIGURATION: PASTE YOUR GOOGLE SCRIPT WEB APP URL HERE
  // ---------------------------------------------------------
  const API_URL = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLglXcI1fa8iKChz3mdXhv-oChfPHvsTJXwuYgFVRo-GjWMt01PVeBAxQhTf7WjnVsriB3uDTekJKY78zKv_8f4qzzoWG_QrwfnM5TtLRNZh5HTvWBpPPfdwBwM3BfMvPuwDiVrA6-y6Gmf6qRbayOLKQ_oQEPFwkbBxbLH2IPqAC9xaJQT5FtEyY58OmKr5zvqqKuZ-ryIoOEIXZxIkdImEWZxEfwlxqOCVT8Vqx9HakcakGi8XYerevkKEBqJS2BqdgPksI4W1z_Uvz4WRoC9vJxb8sQ&lib=MqM-e6Tj6iuMNNG1DGX1reakSBV0V9Esu"; 
  // ---------------------------------------------------------

  let globalData = {};

  // 1. Initial Load
  document.addEventListener('DOMContentLoaded', () => {
    fetchData();
  });

  // 2. Fetch Data from Google Sheets
  async function fetchData() {
    try {
      const response = await fetch(API_URL);
      const data = await response.json();
      globalData = data;
      renderAllSubjects(data);
      document.getElementById('loader').classList.remove('active');
    } catch (error) {
      console.error("Error fetching data:", error);
      document.getElementById('content-area').innerHTML = `<div class="empty-state">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.</div>`;
    }
  }

  // 3. Render Logic
  function renderAllSubjects(data) {
    const container = document.getElementById('content-area');
    container.innerHTML = '';

    const subjects = ['chemistry', 'biology', 'math', 'arabic', 'physics', 'english'];
    const subjectTitles = {
      'chemistry': 'Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡', 'biology': 'Ø§Ù„Ø£Ø­ÙŠØ§Ø¡', 'math': 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª', 
      'arabic': 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', 'physics': 'Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡', 'english': 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©'
    };

    subjects.forEach((subj, index) => {
      const isActive = index === 0 ? 'active-content' : '';
      const subjData = data[subj]; // Object grouped by Grade

      let html = `<div id="${subj}" class="subject-content ${isActive}">
                    <div class="subject-card">
                      <div class="card-header">${subjectTitles[subj]}</div>`;

      if (!subjData || Object.keys(subjData).length === 0) {
        html += `<div class="empty-state">ğŸ‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª ØªÙ… Ø±ÙØ¹Ù‡Ø§!</div>`;
      } else {
        // Iterate over Grades (G12, G09, etc.)
        for (const [grade, lectures] of Object.entries(subjData)) {
          html += `
            <details open>
              <summary>${grade}</summary>
              <div class="table-wrapper">
                <table>
                  <thead><tr><th class="chapter-col">Ø§Ù„ÙØµÙ„</th><th class="desc-col">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</th><th class="status-col">Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                  <tbody>
                    ${lectures.map(lec => `
                      <tr id="row-${lec.id}">
                        <td class="chapter-col">${lec.chapter}</td>
                        <td class="desc-col">${lec.lecture}</td>
                        <td class="status-cell">
                          <button class="upload-btn" onclick="markAsUploaded('${lec.id}', '${subj}', this)">
                            ØªÙ… Ø§Ù„Ø±ÙØ¹
                          </button>
                        </td>
                      </tr>
                    `).join('')}
                  </tbody>
                </table>
              </div>
            </details>`;
        }
      }

      html += `</div></div>`;
      container.insertAdjacentHTML('beforeend', html);
    });
  }

  // 4. Handle "Mark as Uploaded"
  window.markAsUploaded = async function(id, subject, btnElement) {
    // UI Update immediately (Optimistic UI)
    btnElement.classList.add('uploading');
    btnElement.innerText = 'Ø¬Ø§Ø± Ø§Ù„Ø­ÙØ¸...';

    // Send to Google Sheets
    try {
      await fetch(API_URL, {
        method: 'POST',
        mode: 'no-cors', // Important for simple GAS calls
        headers: { 'Content-Type': 'text/plain' },
        body: JSON.stringify({ id: id, subject: subject })
      });

      // On Success: Remove row visually
      const row = document.getElementById(`row-${id}`);
      if (row) {
        row.classList.add('fade-out');
        setTimeout(() => row.remove(), 500); // Remove from DOM after animation
      }

    } catch (error) {
      console.error('Error updating:', error);
      btnElement.classList.remove('uploading');
      btnElement.innerText = 'Ø®Ø·Ø£! Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹';
    }
  };

  // 5. Tab Switching
  window.switchTab = function(subjectId) {
    // Hide all contents
    document.querySelectorAll('.subject-content').forEach(c => c.classList.remove('active-content'));
    // Deactivate all buttons
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    
    // Show selected
    const content = document.getElementById(subjectId);
    if(content) content.classList.add('active-content');
    
    // Activate button
    event.target.classList.add('active');
  };
</script>

</body>
</html>
