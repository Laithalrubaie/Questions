<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --bg: #f4f6fb; --card: #ffffff; --primary: #2f3a8f; --secondary: #e9ecff; --text: #1f2937; --muted: #6b7280; --border: #e5e7eb; --radius: 14px; --success: #10b981; }
    body { margin: 0; font-family: "Cairo", sans-serif; background: var(--bg); color: var(--text); }
    .container { max-width: 1100px; margin: auto; padding: 32px 20px 60px; }
    header { text-align: center; margin-bottom: 30px; }
    .tabs-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 30px; background: #fff; padding: 15px; border-radius: var(--radius); }
    .tab-btn { background: transparent; border: 2px solid var(--secondary); color: var(--muted); padding: 8px 16px; border-radius: 50px; font-family: "Cairo"; font-weight: 700; cursor: pointer; }
    .tab-btn.active { background: var(--primary); border-color: var(--primary); color: #fff; }
    .subject-content { display: none; }
    .active-content { display: block; }
    .subject-card { background: var(--card); border-radius: var(--radius); margin-bottom: 20px; border: 1px solid var(--border); overflow: hidden; }
    .card-header { padding: 15px 20px; font-weight: 700; color: var(--primary); background: linear-gradient(135deg, var(--secondary), #ffffff); border-bottom: 1px solid var(--border); }
    details { border-bottom: 1px solid var(--border); }
    summary { cursor: pointer; padding: 15px 20px; font-weight: 600; display: flex; justify-content: space-between; }
    table { width: 100%; border-collapse: collapse; min-width: 500px; }
    th, td { padding: 14px 20px; border-bottom: 1px solid var(--border); vertical-align: middle; }
    th.chapter-col { width: 25%; color: var(--primary); background: #fcfcfc; }
    .upload-btn { background: var(--secondary); color: var(--primary); border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-family: "Cairo"; font-weight: bold; }
    .upload-btn:hover { background: var(--primary); color: white; }
    .table-wrapper { overflow-x: auto; }
    
    /* MODAL STYLES */
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; }
    .modal-overlay.open { display: flex; }
    .modal-card { background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 500px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); position: relative; }
    .modal-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 20px; color: var(--primary); }
    .file-drop-area { border: 2px dashed var(--secondary); padding: 30px; text-align: center; border-radius: 10px; margin-bottom: 20px; cursor: pointer; transition: 0.3s; }
    .file-drop-area:hover { border-color: var(--primary); background: #fafbff; }
    .file-input { display: none; }
    .file-list { margin-bottom: 20px; max-height: 150px; overflow-y: auto; font-size: 0.9rem; }
    .file-item { display: flex; justify-content: space-between; padding: 8px; background: #f8f9fa; margin-bottom: 5px; border-radius: 6px; }
    .modal-actions { display: flex; gap: 10px; }
    .btn-submit { flex: 2; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 10px; font-family: "Cairo"; font-weight: bold; cursor: pointer; }
    .btn-submit:disabled { background: #ccc; cursor: not-allowed; }
    .btn-cancel { flex: 1; background: transparent; border: 1px solid #ddd; color: #666; border-radius: 10px; cursor: pointer; font-family: "Cairo"; }
    
    .spinner { width: 20px; height: 20px; border: 3px solid #ffffff33; border-top: 3px solid white; border-radius: 50%; animation: spin 1s linear infinite; margin: auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>Ù…ØªØ§Ø¨Ø¹Ø© Ø±ÙØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h1>
    <p>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© ÙˆØ±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª</p>
  </header>

  <div class="tabs-container">
    <button class="tab-btn active" onclick="switchTab('chemistry')">Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡</button>
    <button class="tab-btn" onclick="switchTab('biology')">Ø§Ù„Ø£Ø­ÙŠØ§Ø¡</button>
    <button class="tab-btn" onclick="switchTab('math')">Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</button>
    <button class="tab-btn" onclick="switchTab('arabic')">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
    <button class="tab-btn" onclick="switchTab('physics')">Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡</button>
    <button class="tab-btn" onclick="switchTab('english')">English</button>
  </div>

  <div id="content-area">
      <div style="text-align:center; padding: 20px;">
          <div class="spinner" style="border-color: #2f3a8f; border-top-color: transparent;"></div>
          <p style="margin-top:10px; color:#666;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
      </div>
  </div>
</div>

<div class="modal-overlay" id="uploadModal">
  <div class="modal-card">
    <div class="modal-title">Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</div>
    <div id="modalSubtitle" style="margin-bottom:15px; font-size:0.9rem; color:#666;"></div>
    
    <div class="file-drop-area" onclick="document.getElementById('fileInput').click()">
      <span style="font-size:24px">ğŸ“‚</span><br>
      Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª<br>
      <span style="font-size:12px; color:#999">PDF, Images, Word</span>
    </div>
    <input type="file" id="fileInput" class="file-input" multiple onchange="handleFileSelect(this)">
    
    <div class="file-list" id="fileList"></div>
    
    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="btn-submit" id="submitBtn" onclick="submitUpload()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±ÙØ¹</button>
    </div>
  </div>
</div>

<script>
  // ------------------------------------
  // IMPORTANT: Ensure no spaces are in this URL
  const API_URL = "https://script.google.com/macros/s/AKfycbx0_Hmdm2gucB87juLA_Rmzt1x8iL-ewnu3MsSf0SnEZQxqmN0e0I_1aktk_vw4j9kN/exec";
  // ------------------------------------

  let currentUpload = { id: null, subject: null, files: [] };

  document.addEventListener('DOMContentLoaded', fetchData);

  async function fetchData() {
    console.log("Start fetching data...");
    try {
      const res = await fetch(API_URL);
      console.log("Response received from Google:", res);
      
      const data = await res.json();
      console.log("Data parsed:", data);
      
      renderAll(data);
    } catch(e) { 
        console.error("Error:", e);
        document.getElementById('content-area').innerHTML = `
            <div style="text-align:center; color:red; padding:20px;">
                <b>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„</b><br>
                ${e.message}<br>
                <button onclick="location.reload()" style="margin-top:10px; padding:5px 10px;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
            </div>`; 
    }
  }

  function renderAll(data) {
    const container = document.getElementById('content-area');
    container.innerHTML = '';
    const map = { 'chemistry': 'Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡', 'biology': 'Ø§Ù„Ø£Ø­ÙŠØ§Ø¡', 'math': 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª', 'arabic': 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', 'physics': 'Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡', 'english': 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©' };
    
    Object.keys(map).forEach((subj, idx) => {
      let html = `<div id="${subj}" class="subject-content ${idx===0?'active-content':''}">
        <div class="subject-card"><div class="card-header">${map[subj]}</div>`;
      
      if(!data[subj] || Object.keys(data[subj]).length === 0) {
        html += `<div style="padding:40px; text-align:center; color:#888">
                    <span style="font-size:30px;">ğŸ‰</span><br>
                    ØªÙ… Ø±ÙØ¹ ÙƒÙ„ Ù…Ø­Ø§Ø¶Ø±Ø§Øª ${map[subj]}!
                 </div>`;
      } else {
        for(const [grade, lecs] of Object.entries(data[subj])) {
          html += `<details open><summary>${grade}</summary><div class="table-wrapper"><table>
            <thead><tr><th class="chapter-col">Ø§Ù„ÙØµÙ„</th><th>Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</th><th style="width:100px">Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead><tbody>
            ${lecs.map(l => `
              <tr id="row-${l.id}">
                <td class="chapter-col">${l.chapter}</td>
                <td>${l.lecture}</td>
                <td style="text-align:center">
                  <button class="upload-btn" onclick="openUploadModal('${l.id}', '${subj}', '${l.lecture}')">Ø±ÙØ¹</button>
                </td>
              </tr>`).join('')}
            </tbody></table></div></details>`;
        }
      }
      html += `</div></div>`;
      container.insertAdjacentHTML('beforeend', html);
    });
  }

  // --- MODAL & FILE HANDLING ---

  window.openUploadModal = function(id, subject, title) {
    currentUpload = { id, subject, files: [] };
    document.getElementById('modalSubtitle').innerText = title;
    document.getElementById('fileList').innerHTML = '';
    document.getElementById('fileInput').value = ''; 
    document.getElementById('uploadModal').classList.add('open');
  }

  window.closeModal = function() {
    document.getElementById('uploadModal').classList.remove('open');
  }

  window.handleFileSelect = function(input) {
    const list = document.getElementById('fileList');
    list.innerHTML = ''; 
    currentUpload.files = [];

    Array.from(input.files).forEach(file => {
      const reader = new FileReader();
      reader.onload = function(e) {
        const base64Data = e.target.result.split(',')[1]; 
        currentUpload.files.push({
          name: file.name,
          mimeType: file.type,
          data: base64Data
        });
      };
      reader.readAsDataURL(file);

      const item = document.createElement('div');
      item.className = 'file-item';
      item.innerText = `ğŸ“„ ${file.name}`;
      list.appendChild(item);
    });
  }

  window.submitUpload = async function() {
    const btn = document.getElementById('submitBtn');
    
    if(currentUpload.files.length === 0) { 
        alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"); 
        return; 
    }

    btn.innerHTML = '<div class="spinner"></div>';
    btn.disabled = true;

    try {
      await fetch(API_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'text/plain' },
        body: JSON.stringify(currentUpload)
      });

      closeModal();
      btn.innerHTML = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±ÙØ¹';
      btn.disabled = false;
      
      const row = document.getElementById(`row-${currentUpload.id}`);
      if(row) {
        row.style.transition = 'all 0.5s';
        row.style.opacity = '0';
        row.style.background = '#e6fffa';
        
        setTimeout(() => {
          const tbody = row.parentElement;
          row.remove();

          if (tbody.children.length === 0) {
             const tableWrapper = tbody.closest('.table-wrapper');
             const details = tableWrapper.parentElement; 
             const subjectCard = details.parentElement;  
             
             details.remove();

             if (subjectCard.querySelectorAll('details').length === 0) {
                 const headerText = subjectCard.querySelector('.card-header').innerText;
                 subjectCard.innerHTML = `
                    <div class="card-header">${headerText}</div>
                    <div style="padding:40px; text-align:center; color:#888; animation: fadeIn 0.5s;">
                        <span style="font-size:30px;">ğŸ‰</span><br>
                        Ø¹Ø§Ø´ØŒ ØªÙ… Ø±ÙØ¹ ÙƒÙ„ Ù…Ø­Ø§Ø¶Ø±Ø§Øª ${headerText}!
                    </div>
                 `;
             }
          }
        }, 500);
      }

    } catch (err) {
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");
      btn.innerHTML = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±ÙØ¹';
      btn.disabled = false;
    }
  }

  window.switchTab = function(id) {
    document.querySelectorAll('.subject-content').forEach(c => c.classList.remove('active-content'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(id).classList.add('active-content');
    event.target.classList.add('active');
  }
</script>
</body>
</html>
